<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Drive</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, viewport-fit=cover" />
  <link rel="stylesheet" href="/css/style.css" />
</head>
<body class="drive-body">
  <div id="map-container">
    <div id="map"></div>
  </div>



  <div class="hud">
    <div class="hud-row">
      <div class="hud-box">
        <div class="hud-label">Current speed</div>
        <div class="hud-value" id="currentSpeed">0</div>
        <div class="hud-unit">km/h</div>
      </div>
      <div class="hud-box">
        <div class="hud-label">Average speed</div>
        <div class="hud-value" id="avgSpeed">-</div>
        <div class="hud-unit">km/h</div>
      </div>
    </div>
    <div class="hud-row">
      <div class="hud-box status-box">
        <div class="hud-label">Status</div>
        <div class="hud-status" id="statusText">Waiting for GPS...</div>
        <div class="hud-status-small" id="cameraText">No cameras yet</div>
      </div>
    </div>
  </div>

  <!-- BUTTONS -->
<button id="burgerBtn" aria-label="Open menu" aria-controls="sidebar" aria-expanded="false" class="burger-btn">
  <span aria-hidden="true">‚ò∞</span>
</button>
<button id="recenterBtn" class="recenter-btn" title="Recenter Map">‚åñ</button>
<button id="radioBtn" class="radio-btn hidden" title="Toggle Radio">üéôÔ∏è</button>


  <aside id="sidebar" class="sidebar" role="complementary" aria-label="Settings" aria-hidden="true">
  <div class="sidebar-content">
    <h3>Settings</h3>
    <div class="theme-row">
      <label class="switch">
        <input type="checkbox" id="themeToggle" aria-label="Toggle dark theme">
        <span class="slider"></span>
      </label>
      <span id="themeLabel" class="theme-label">Light</span>
    </div>
    <div class="theme-row">
      <label class="switch">
        <input type="checkbox" id="radioToggle" aria-label="Toggle radio">
        <span class="slider"></span>
      </label>
      <span class="theme-label">Radio</span>
    </div>

        <!-- HISTORY LINK -->
    <a href="/history" class="sidebar-nav-link">
      üìä History
    </a>
    
    <!-- LOGOUT BUTTON -->
    <form class="logout-form" action="/logout" method="post">
      <% if (user && user.acc_type === 2) { %>
        <!-- ADMIN BUTTON (only for admins) -->
        <a href="/admin/dashboard" class="sidebar-nav-link admin-link" style="margin-bottom: 12px; display: block;">
          ‚öôÔ∏è Admin
        </a>
      <% } %>
      <button type="submit">Logout</button>
    </form>


  </div>
</aside>

  
  <div id="sidebarOverlay" class="overlay" aria-hidden="true"></div>


  <!-- WARNING MODAL (centered between HUD and top of screen) -->
  <div id="warningModal" class="warning-modal hidden">
    <div class="modal-content">
      <div class="modal-icon">Warning</div>
      <h2 id="modalCameraName">–ü—Ä–∏–±–ª–∏–∂–∞–≤–∞—Ç–µ –∫–∞–º–µ—Ä–∞</h2>
      <p class="modal-limit">–õ–∏–º–∏—Ç: <strong id="modalLimitValue">--</strong> km/h</p>



      <div class="modal-footer">
        <div id="countdown">–ó–∞—Ç–≤–∞—Ä—è —Å–µ —Å–ª–µ–¥ <span id="countdownSeconds">15</span> —Å–µ–∫</div>
        <button id="closeModalBtn">–ó–∞—Ç–≤–æ—Ä–∏</button>
      </div>
    </div>
  </div>



  <!-- Dark overlay -->
  <div id="modalOverlay" class="modal-overlay hidden"></div>



  <script>
  (g => {
    var h, a, k, p = "The Google Maps JavaScript API", c = "google", l = "importLibrary", q = "__ib__", m = document, b = window;
    b = b[c] || (b[c] = {});
    var d = b.maps || (b.maps = {}), r = new Set(), e = new URLSearchParams(), u = () => h || (h = new Promise(async (f, n) => {
      await (a = m.createElement("script"));
      e.set("libraries", [...r] + "");
      for (k in g) e.set(k.replace(/[A-Z]/g, t => "_" + t.toLowerCase()), g[k]);
      e.set("callback", c + ".maps." + q);
      a.src = `https://maps.${c}apis.com/maps/api/js?` + e;
      d[q] = f;
      a.onerror = () => h = n(Error(p + " could not load."));
      a.nonce = m.querySelector("script[nonce]")?.nonce || "";
      m.head.append(a);
    }));
    d[l] ? console.warn(p + " only loads once. Ignoring:", g) : d[l] = (f, ...n) => r.add(f) && u().then(() => d[l](f, ...n));
  })({
    key: "<%= mapsApiKey %>",
    v: "weekly",
    libraries: "geometry"
  });
</script>


  <script src="/js/drive.js"></script>


</body>
</html>
